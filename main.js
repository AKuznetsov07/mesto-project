(()=>{"use strict";var e=function(e){return function(e){var t=function(e){return document.querySelector(e).content}(e);return t.firstElementChild.cloneNode(!0)}(e)},t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"870f9827-3765-496c-aae9-f242e8f8bcfb","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(s)},r=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(s)},o=function(e){return function(e){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(s)}(e)},i=function(e,n){return function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:n})}).then(s)}(e,n)},u=function(e){return function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(s)}(e)},c=function(e){return function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(s)}(e)},a=function(e){return function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(s)}(e)},l=function(e){return function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(s)}(e)};function s(e){return e.ok?e.json():Promise.reject("������ ".concat(e.status))}var d=null,f=function(e,t,n,r,o){return function(e,t,n,r,o){d=o;var i=e.querySelector(".elements__like-button"),u=e.querySelector(".elements__like-count");p(t,i,u);var l=e.querySelector(".elements__image"),s=e.querySelector(".elements__remove-button");e.querySelector(".elements__caption").textContent=t.name,l.src=t.link,l.alt=t.name,i.addEventListener("click",(function(e){return function(e,t,n,r){var o=t.likes.some((function(e){return e._id==d}));o?a(t._id).then((function(e){t.likes=e.likes})).then((function(e){return p(t,n,r)})).catch((function(e){return console.log("������: ".concat(e))})):c(t._id).then((function(e){t.likes=e.likes})).then((function(e){return p(t,n,r)})).catch((function(e){return console.log("������: ".concat(e))}))}(0,t,i,u)})),n&&(s.classList.remove("hidden-node"),s.addEventListener("click",n)),l.addEventListener("click",r)}(e,t,n,r,o)};function p(e,t,n){var r=e.likes.some((function(e){return e._id==d}));r?t.classList.add("elements__like-button_selected"):t.classList.remove("elements__like-button_selected"),n.textContent=e.likes.length}var m=null,v={handlePopup:function(e){return function(e){var t=e.querySelector(".popup__cancel-button");t&&t.addEventListener("click",(function(t){y(e)})),e.addEventListener("mousedown",(function(t){return function(e,t){e.target.classList.contains("popup")&&y(t)}(t,e)}))}(e)},showPopup:function(e){return function(e){m&&closeDialog(m),document.addEventListener("keydown",h),e.classList.add("popup_opened"),m=e}(e)},closeActivePopup:function(){return y(m)}};function h(e){"Escape"===e.key&&y(m)}function y(e){document.removeEventListener("keydown",h,!1),e.classList.remove("popup_opened"),m=null}var _=new Map,b=document.querySelector(".popup_type_confirm-delete"),S=b.querySelector(".edit-form"),q=null,k=null,E=null,g=null,C=null,L={initialize:function(e,t,n,r,o){return function(e,t,n,r,o){k=e,E=t,g=n,C=r,b&&v.handlePopup(b),o.forEach((function(e){return P(e)})),S.addEventListener("submit",(function(e){return e.preventDefault(),t=_.get(q),void u(q).then((function(e){return t.view.remove()})).then((function(e){return _.delete(q)})).then(v.closeActivePopup).catch((function(e){return console.log("������: ".concat(e))}));var t}))}(e,t,n,r,o)},add:function(e){return P(e)},remove:function(e){return w(e)},imageClickedEventName:"imageClicked"};function P(t){if(t&&!_.has(t._id)){var n=t.owner._id==C,r=function(t,n){var r=e(E),o=t.name,i=t.link,u=null;return n&&(u=function(){return w(t._id)}),f(r,t,u,(function(){return g(i,o)}),C),r}(t,n),o={model:t,view:r,isDeletable:n};_.set(t._id,o),k.prepend(r)}}function w(e){q=e,v.showPopup(b)}var A="",x="",U="",T={enableValidation:function(e){return function(e){A=e.inputErrorClass,x=e.inputSelector,U=e.submitButtonSelector,document.querySelectorAll(e.formSelector).forEach((function(e){var t=Array.from(e.querySelectorAll(x)),n=e.querySelector(U);j(t,n),t.forEach((function(r){r.addEventListener("input",(function(o){var i,u,c;i=e,c=function(e,t){return t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.patternMismatch}(0,u=r),u.validity.valid?O(i,u):D(i,u,u.validationMessage),c&&u.validity.valid,j(t,n)}))}))}))}(e)},prepareFormValidation:function(e){return function(e){var t=Array.from(e.querySelectorAll(x)),n=e.querySelector(U);j(t,n),t.forEach((function(t){O(e,t)}))}(e)}},j=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0},D=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(A),r.textContent=n},O=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(A),n.textContent=""};function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N,F,I=null,M=document.querySelector(".profile"),z=M.querySelector(".profile__fio"),J=M.querySelector(".profile__profession"),B=document.querySelector(".profile__avatar"),H=document.querySelector(".profile__avatar-hover"),$=document.querySelector(".popup_type_edit-card"),G=document.querySelector(".popup_type_edit-bio"),K=document.querySelector(".popup_type_edit-avatar"),Q=document.querySelector(".popup_type_view-card"),R=Q.querySelector(".view-form__image"),W=Q.querySelector(".view-form__caption"),X=$.querySelector(".edit-form"),Y=G.querySelector(".edit-form"),Z=K.querySelector(".edit-form"),ee=Y.querySelector(".edit-form__button_action_submit"),te=X.querySelector(".edit-form__button_action_submit"),ne=Z.querySelector(".edit-form__button_action_submit"),re=document.querySelector(".elements");function oe(){z.textContent=I.name,J.textContent=I.about,B.src=I.avatar}N=n(),F=r(),Promise.all([N,F]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,c=[],a=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];I=o,oe(),L.initialize(re,"#placeCardTemplate",(function(e,t){return function(e,t){R.src=e,R.alt=t,W.textContent=t,v.showPopup(Q)}(e,t)}),I._id,i)})).catch((function(e){return console.log("Ошибка: ".concat(e))})),document.querySelector(".profile__add-button").addEventListener("click",(function(e){return X.reset(),T.prepareFormValidation(X),void v.showPopup($)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(e){return Y.Fio.value=z.textContent,Y.Profession.value=J.textContent,T.prepareFormValidation(Y),void v.showPopup(G)})),H.addEventListener("click",(function(e){return Z.ImgLink.value=I.avatar,T.prepareFormValidation(K),void v.showPopup(K)})),L&&re.addEventListener(L.imageClickedEventName,(function(e){R.src=e.detail.uri,R.alt=e.detail.title,W.textContent=e.detail.title,v.showPopup(Q)})),Y.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),ee.textContent="Сохранение...",I.name=Y.Fio.value,I.about=Y.Profession.value,o(I).then((function(e){ee.textContent="Сохранить",oe(),v.closeActivePopup()})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}(e)})),X.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),te.textContent="Сохранение...",i(X.CardName.value,X.ImgLink.value).then((function(e){return L.add(e)})).then((function(e){te.textContent="Создать",v.closeActivePopup(t)})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}(e,$)})),Z.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),ne.textContent="Сохранение...";var n=Z.ImgLink.value;l(n).then((function(e){I.avatar=n,oe()})).then((function(e){ne.textContent="Сохранить",v.closeActivePopup(t)})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}(e,K)})),v&&(v.handlePopup($),v.handlePopup(G),v.handlePopup(K),v.handlePopup(Q)),T&&T.enableValidation({formSelector:".edit-form",inputSelector:".edit-form__item",submitButtonSelector:".edit-form__button_action_submit",inputErrorClass:"edit-form__item_error"})})();